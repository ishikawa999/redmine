<% if change_item.is_a?(Journal) && (journal = change_item) %>
  <div id="change-<%= journal.id %>" class="<%= journal.css_classes %>">
    <div id="note-<%= journal.indice %>" class="note">
    <div class="contextual">
      <span class="journal-actions"><%= render_journal_actions(issue, journal, :reply_links => reply_links) %></span>
      <a href="#note-<%= journal.indice %>" class="journal-link">#<%= journal.indice %></a>
    </div>
    <h4 class='note-header'>
      <%= avatar(journal.user) %>
      <%= authoring journal.created_on, journal.user, :label => :label_updated_time_by %>
      <%= render_private_notes_indicator(journal) %>
      <%= render_journal_update_info(journal) %>
    </h4>

    <% if journal.details.any? %>
    <ul class="details">
      <% details_to_strings(journal.visible_details).each do |string| %>
       <li><%= string %></li>
      <% end %>
    </ul>
    <% if Setting.thumbnails_enabled? && (thumbnail_attachments = journal_thumbnail_attachments(journal)).any? %>
      <div class="thumbnails">
        <% thumbnail_attachments.each do |attachment| %>
          <%= thumbnail_tag(attachment) %>
        <% end %>
      </div>
    <% end %>
    <% end %>
    <%= render_notes(issue, journal, :reply_links => reply_links) unless journal.notes.blank? %>
    </div>
  </div>
  <%= call_hook(:view_issues_history_journal_bottom, { :journal => journal }) %>
<% elsif change_item.is_a?(TimeEntry) && (time_entry = change_item) %>
  <div id="time-entry-<%= time_entry.id %>" class="time_entry journal">
    <div class="note">
    <% if time_entry.editable_by?(User.current) -%>
      <div class="contextual">
        <span class="journal-actions">
        <%= link_to sprite_icon('edit', l(:button_edit)), edit_time_entry_path(time_entry),
                    :title => l(:button_edit),
                    :class => 'icon-only icon-edit ' %>
        <%= link_to sprite_icon('del', l(:button_delete)), time_entry_path(time_entry),
                    :data => {:confirm => l(:text_are_you_sure)},
                    :method => :delete,
                    :title => l(:button_delete),
                    :class => 'icon-only icon-del ' %>
        </span>
      </div>
    <% end -%>
    <h4 class='note-header'>
      <%= avatar(time_entry.user, :size => "24") %>
      <%= authoring time_entry.created_on, time_entry.user, :label => :label_added_time_by %>
    </h4>
    <ul class="details">
      <li>
        <strong><%= l(:label_time_entry_plural) %></strong>:
        <%= l_hours_short time_entry.hours %>
      </li>
    </ul>
    <p><%= time_entry.comments %></p>
    </div>
  </div>
  <%= call_hook(:view_issues_history_time_entry_bottom, { :time_entry => time_entry }) %>
<% elsif change_item.is_a?(Changeset) && (changeset = change_item) %>
  <div id="changeset-<%= changeset.id %>" class="changeset journal">
    <div class="note">
    <h4 class='note-header'>
      <%= avatar(changeset.user, :size => "24") %>
      <%= authoring changeset.committed_on, changeset.author, :label => :label_added_time_by %>
    </h4>
    <p>
    <%= "#{changeset.project.name} - " unless changeset.project == project %>
    <%= link_to_revision(changeset, changeset.repository,
                        :text => "#{l(:label_revision)} #{changeset.format_identifier}") %>
    <% if changeset.filechanges.any? && User.current.allowed_to?(:browse_repository, changeset.project) %>
    (<%= link_to(l(:label_diff),
            :controller => 'repositories',
            :action => 'diff',
            :id     => changeset.project,
            :repository_id => changeset.repository.identifier_param,
            :path   => "",
            :rev    => changeset.identifier) %>)
    <% end %></p>

    <div class="wiki changeset-comments">
      <%= format_changeset_comments changeset %>
    </div>
    </div>
  </div>
  <%= call_hook(:view_issues_history_changeset_bottom, { :changeset => changeset }) %>
<% end %>